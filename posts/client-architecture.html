<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°ä»£å®¢æˆ·ç«¯æ¶æ„è®¾è®¡ - Waffle's Blog</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">
                <a href="../index.html"><code>Waffle</code></a>
            </div>
            <ul class="nav-links">
                <li><a href="../posts.html" class="active">æ–‡ç« </a></li>
                <li><a href="../projects.html">é¡¹ç›®</a></li>
                <li><a href="../changelog.html">æ›´æ–°æ—¥å¿—</a></li>
                <li><a href="../about.html">å…³äº</a></li>
                <li><a href="https://github.com/WaffleHFB" target="_blank" class="github-link">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <main class="container post-detail">
        <article>
            <header class="post-header">
                <div class="post-meta">
                    <time>2024-03-10</time>
                    <span class="tag">å¼€å‘</span>
                    <span class="tag">æ¶æ„</span>
                </div>
                <h1>ç°ä»£å®¢æˆ·ç«¯æ¶æ„è®¾è®¡</h1>
                <div class="post-info">
                    <span>é˜…è¯»æ—¶é—´ï¼š35åˆ†é’Ÿ</span>
                    <span>ä½œè€…ï¼šWaffle</span>
                </div>
            </header>

            <div class="post-content">
                <h2>å‰è¨€</h2>
                <p>ä¸€ä¸ªä¼˜ç§€çš„å®¢æˆ·ç«¯æ¶æ„ä¸ä»…è¦è€ƒè™‘æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿˜è¦è€ƒè™‘åˆ°æœªæ¥çš„æ‰©å±•æ€§ã€‚æœ¬æ–‡å°†ä»å®æˆ˜ç»éªŒå‡ºå‘ï¼Œæ·±å…¥æ¢è®¨ç°ä»£å®¢æˆ·ç«¯çš„æ¶æ„è®¾è®¡ã€‚</p>

                <h2>æ ¸å¿ƒæ¶æ„</h2>
                <h3>æ¨¡å—åŒ–è®¾è®¡</h3>
                <div class="code-block">
                    <pre><code>
// åŸºç¡€æ¨¡å—æ¥å£
public interface IModule {
    void onEnable();
    void onDisable();
    void onTick();
    
    String getName();
    Category getCategory();
    ModuleInfo getInfo();
}

// æ¨¡å—åŸºç±»
public abstract class Module implements IModule {
    @Getter private final String name;
    @Getter private final Category category;
    @Getter private boolean enabled;
    
    @Getter private final List<Setting<?>> settings = new ArrayList<>();
    @Getter private final EventManager eventManager;
    
    protected Module(String name, Category category) {
        this.name = name;
        this.category = category;
        this.loadSettings();
    }
    
    protected void registerSetting(Setting<?> setting) {
        settings.add(setting);
    }
}

// æ¨¡å—ç®¡ç†å™¨
public class ModuleManager {
    private final Map<String, Module> modules = new HashMap<>();
    private final EventBus eventBus;
    
    public void loadModule(Module module) {
        modules.put(module.getName(), module);
        eventBus.register(module);
    }
    
    public void enableModule(String name) {
        Module module = modules.get(name);
        if (module != null && !module.isEnabled()) {
            module.onEnable();
        }
    }
}
                    </code></pre>
                </div>

                <h3>äº‹ä»¶ç³»ç»Ÿ</h3>
                <p>ä¸€ä¸ªé«˜æ•ˆçš„äº‹ä»¶ç³»ç»Ÿæ˜¯å®¢æˆ·ç«¯çš„æ ¸å¿ƒï¼š</p>
                <div class="code-block">
                    <pre><code>
// äº‹ä»¶æ€»çº¿
public class EventBus {
    private final Map<Class<?>, List<EventHandler>> handlers = new HashMap<>();
    
    public void register(Object listener) {
        for (Method method : listener.getClass().getDeclaredMethods()) {
            if (method.isAnnotationPresent(EventHandler.class)) {
                registerHandler(method, listener);
            }
        }
    }
    
    public void post(Event event) {
        List<EventHandler> eventHandlers = handlers.get(event.getClass());
        if (eventHandlers != null) {
            for (EventHandler handler : eventHandlers) {
                if (event.isCancelled() && !handler.ignoreCancelled()) {
                    continue;
                }
                handler.invoke(event);
            }
        }
    }
}

// ä¼˜å…ˆçº§ç³»ç»Ÿ
public enum Priority {
    LOWEST(0),
    LOW(1),
    NORMAL(2),
    HIGH(3),
    HIGHEST(4);
    
    private final int value;
    
    Priority(int value) {
        this.value = value;
    }
}
                    </code></pre>
                </div>

                <h2>é…ç½®ç³»ç»Ÿ</h2>
                <h3>åºåˆ—åŒ–è®¾è®¡</h3>
                <div class="code-block">
                    <pre><code>
// é…ç½®åºåˆ—åŒ–
public class ConfigManager {
    private final File configDir;
    private final Gson gson;
    
    public void saveModule(Module module) {
        Map<String, Object> config = new HashMap<>();
        for (Setting<?> setting : module.getSettings()) {
            config.put(setting.getName(), setting.getValue());
        }
        
        String json = gson.toJson(config);
        Files.write(
            configDir.toPath()
                .resolve(module.getName() + ".json"),
            json.getBytes()
        );
    }
    
    public void loadModule(Module module) {
        Path configPath = configDir.toPath()
            .resolve(module.getName() + ".json");
            
        if (Files.exists(configPath)) {
            String json = new String(Files.readAllBytes(configPath));
            Map<String, Object> config = gson.fromJson(
                json, 
                new TypeToken<Map<String, Object>>(){}.getType()
            );
            
            for (Setting<?> setting : module.getSettings()) {
                if (config.containsKey(setting.getName())) {
                    setting.setValue(config.get(setting.getName()));
                }
            }
        }
    }
}
                    </code></pre>
                </div>

                <h2>æ€§èƒ½ä¼˜åŒ–</h2>
                <h3>å†…å­˜ç®¡ç†</h3>
                <p>åˆç†çš„å†…å­˜ç®¡ç†å¯¹å®¢æˆ·ç«¯æ€§èƒ½è‡³å…³é‡è¦ï¼š</p>
                <div class="code-block">
                    <pre><code>
// å¯¹è±¡æ± 
public class ObjectPool<T> {
    private final Queue<T> pool;
    private final Supplier<T> factory;
    private final Consumer<T> reset;
    
    public T obtain() {
        T obj = pool.poll();
        if (obj == null) {
            obj = factory.get();
        }
        return obj;
    }
    
    public void recycle(T obj) {
        reset.accept(obj);
        pool.offer(obj);
    }
}

// ç¼“å­˜ç³»ç»Ÿ
public class CacheManager {
    private final Map<String, Cache<?>> caches = new HashMap<>();
    
    public <T> void putCache(String key, T value, long ttl) {
        caches.put(key, new Cache<>(value, ttl));
    }
    
    public <T> Optional<T> getCache(String key) {
        Cache<?> cache = caches.get(key);
        if (cache != null && !cache.isExpired()) {
            return Optional.of((T) cache.getValue());
        }
        return Optional.empty();
    }
}
                    </code></pre>
                </div>

                <h2>æ¸²æŸ“ç³»ç»Ÿ</h2>
                <h3>æ¸²æŸ“ä¼˜åŒ–</h3>
                <div class="code-block">
                    <pre><code>
// VBO ç®¡ç†å™¨
public class VBOManager {
    private final Map<String, Integer> vbos = new HashMap<>();
    
    public void createVBO(String name, float[] data) {
        int vboId = GL15.glGenBuffers();
        GL15.glBindBuffer(GL15.GL_ARRAY_BUFFER, vboId);
        GL15.glBufferData(GL15.GL_ARRAY_BUFFER, 
                         BufferUtils.createFloatBuffer(data), 
                         GL15.GL_STATIC_DRAW);
        vbos.put(name, vboId);
    }
    
    public void render(String name) {
        Integer vboId = vbos.get(name);
        if (vboId != null) {
            GL15.glBindBuffer(GL15.GL_ARRAY_BUFFER, vboId);
            GL11.glDrawArrays(GL11.GL_TRIANGLES, 0, 6);
        }
    }
}

// æ‰¹é‡æ¸²æŸ“
public class BatchRenderer {
    private final List<RenderCommand> commands = new ArrayList<>();
    
    public void submit(RenderCommand cmd) {
        commands.add(cmd);
    }
    
    public void flush() {
        commands.sort((a, b) -> 
            Float.compare(a.getLayer(), b.getLayer())
        );
        
        for (RenderCommand cmd : commands) {
            cmd.execute();
        }
        commands.clear();
    }
}
                    </code></pre>
                </div>

                <h2>è®¾è®¡æ¨¡å¼åº”ç”¨</h2>
                <h3>å¸¸ç”¨æ¨¡å¼</h3>
                <ul>
                    <li>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆäº‹ä»¶ç³»ç»Ÿï¼‰</li>
                    <li>å•ä¾‹æ¨¡å¼ï¼ˆç®¡ç†å™¨ç±»ï¼‰</li>
                    <li>å·¥å‚æ¨¡å¼ï¼ˆæ¨¡å—åˆ›å»ºï¼‰</li>
                    <li>ç­–ç•¥æ¨¡å¼ï¼ˆæ¸²æŸ“ç­–ç•¥ï¼‰</li>
                    <li>å»ºé€ è€…æ¨¡å¼ï¼ˆé…ç½®æ„å»ºï¼‰</li>
                </ul>

                <div class="code-block">
                    <pre><code>
// å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹
public class ModuleBuilder {
    private String name;
    private Category category;
    private List<Setting<?>> settings = new ArrayList<>();
    
    public ModuleBuilder name(String name) {
        this.name = name;
        return this;
    }
    
    public ModuleBuilder category(Category category) {
        this.category = category;
        return this;
    }
    
    public ModuleBuilder addSetting(Setting<?> setting) {
        settings.add(setting);
        return this;
    }
    
    public Module build() {
        Module module = new Module(name, category) {
            @Override
            public void onEnable() {
                // å®ç°é€»è¾‘
            }
        };
        
        settings.forEach(module::registerSetting);
        return module;
    }
}
                    </code></pre>
                </div>

                <h2>æœ€ä½³å®è·µ</h2>
                <ul>
                    <li>æ¨¡å—ä¹‹é—´ä¿æŒä½è€¦åˆ</li>
                    <li>åˆç†ä½¿ç”¨è®¾è®¡æ¨¡å¼</li>
                    <li>æ³¨é‡æ€§èƒ½ä¼˜åŒ–</li>
                    <li>ä¿æŒä»£ç å¯ç»´æŠ¤æ€§</li>
                    <li>åšå¥½å¼‚å¸¸å¤„ç†</li>
                    <li>ç¼–å†™å•å…ƒæµ‹è¯•</li>
                </ul>

                <div class="warning-block">
                    <p>æ³¨æ„ï¼šå¥½çš„æ¶æ„æ˜¯åœ¨å®è·µä¸­ä¸æ–­ä¼˜åŒ–çš„ç»“æœï¼Œæ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„æ–¹æ¡ˆã€‚è¦æ ¹æ®å®é™…éœ€æ±‚çµæ´»è°ƒæ•´ã€‚</p>
                </div>

                <h2>æ€»ç»“</h2>
                <p>ä¸€ä¸ªä¼˜ç§€çš„å®¢æˆ·ç«¯æ¶æ„éœ€è¦åœ¨æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚é€šè¿‡åˆç†çš„æ¨¡å—åŒ–è®¾è®¡ã€é«˜æ•ˆçš„äº‹ä»¶ç³»ç»Ÿå’Œè‰¯å¥½çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºä¸€ä¸ªç¨³å®šä¸”é«˜æ•ˆçš„å®¢æˆ·ç«¯ã€‚</p>
            </div>

            <footer class="post-footer">
                <div class="post-tags">
                    <span class="tag">æ¶æ„</span>
                    <span class="tag">è®¾è®¡æ¨¡å¼</span>
                    <span class="tag">æ€§èƒ½ä¼˜åŒ–</span>
                </div>
                <div class="post-nav">
                    <a href="client-security.html" class="post-nav-next">
                        ä¸‹ä¸€ç¯‡ï¼šå®¢æˆ·ç«¯å®‰å…¨æ€§è®¾è®¡ â†’
                    </a>
                </div>
            </footer>
        </article>
    </main>

    <footer>
        <div class="container">
            <p>Â© 2024 Waffle's Blog. Built with ğŸ’» and ğŸ®</p>
        </div>
    </footer>
    <script src="../particles.js"></script>
    <script src="../matrix-rain.js"></script>
</body>
</html> 