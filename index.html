<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Waffleâ€˜s Blog</title>
    <style>
        /* CSS å˜é‡å®šä¹‰ */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #333;
            --header-bg: rgba(70, 130, 180, 0.8);
            --nav-bg: rgba(100, 149, 237, 0.9);
            --button-bg: #4682B4;
            --button-hover-bg: #5A9BD5;
            --card-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* æ·±è‰²ä¸»é¢˜å˜é‡ */
        [data-theme="dark"] {
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --header-bg: rgba(44, 62, 80, 0.8);
            --nav-bg: rgba(41, 128, 185, 0.9);
            --button-bg: #3498db;
            --button-hover-bg: #2980b9;
            --card-bg: rgba(44, 62, 80, 0.9);
            --shadow: 0 4px 6px rgba(0,0,0,0.5);
        }
		[data-theme="dark"] {
		    --bg-color: #2c3e50;
		    --text-color: #ecf0f1;
		    --header-bg: rgba(44, 62, 80, 0.8);
		    --nav-bg: rgba(41, 128, 185, 0.9);
		    --button-bg: #3498db;
		    --button-hover-bg: #2980b9;
		    --card-bg: rgba(44, 62, 80, 0.9);
		    --shadow: 0 4px 6px rgba(0,0,0,0.5);
		}
		
		/* æ·±è‰²æ¨¡å¼ä¸‹çš„è¯„è®ºåŒºæ ·å¼ */
		[data-theme="dark"] .comments-section {
		    background: rgba(44, 62, 80, 0.9);  /* æ·±è‰²èƒŒæ™¯ */
		    color: #ecf0f1;  /* æµ…è‰²æ–‡å­— */
		}
		
		[data-theme="dark"] .comment {
		    background: rgba(60, 60, 60, 0.9);  /* æ·±è‰²è¯„è®ºèƒŒæ™¯ */
		    color: #ecf0f1;  /* æµ…è‰²æ–‡å­— */
		}
		
		[data-theme="dark"] #comment-input {
		    background: rgba(60, 60, 60, 0.9);  /* æ·±è‰²èƒŒæ™¯ */
		    color: #ecf0f1;  /* æµ…è‰²æ–‡å­— */
		}
		
		[data-theme="dark"] #comment-submit {
		    background-color: #3498db;  /* è¯„è®ºæŒ‰é’®çš„æ·±è‰²æ¨¡å¼èƒŒæ™¯è‰² */
		    color: #fff;
		}
		
		[data-theme="dark"] #comment-submit:hover {
		    background-color: #2980b9;  /* æ‚¬æµ®æ—¶çš„èƒŒæ™¯è‰² */
		}


        /* åŸºæœ¬æ ·å¼ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: var(--header-bg);
            color: #fff;
            padding: 20px 0;
            text-align: center;
            position: sticky;
            top: 0;
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
        }

        nav {
            display: flex;
            justify-content: center;
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
        }

        nav a {
            color: #fff;
            padding: 15px 25px;
            text-decoration: none;
            text-transform: uppercase;
            font-weight: bold;
            transition: background 0.3s, color 0.3s;
        }

        nav a:hover {
            background: var(--button-hover-bg);
            color: #fff;
            border-radius: 5px;
        }

        .container {
            flex: 1;
            padding: 30px 20px;
            max-width: 1200px;
            margin: auto;
            display: flex;
        }

        .hidden {
            display: none;
        }

        /* å·¦ä¾§åˆ†ç±»æ  */
        .sidebar {
            width: 200px;
            margin-right: 20px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
            height: fit-content;
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: var(--button-bg);
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 10px;
        }

        .sidebar button {
            width: 100%;
            padding: 10px;
            border: none;
            background-color: var(--button-bg);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .sidebar button:hover {
            background-color: var(--button-hover-bg);
        }

        /* æ¬¢è¿ä¿¡æ¯ */
        .welcome {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-bg);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .welcome span {
            font-size: 1.2em;
            color: var(--text-color);
        }

        .logout-btn {
            background-color: #e74c3c;
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--button-bg);
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: background 0.3s, transform 0.3s;
        }
		
		.comment button {
		    background-color: #e74c3c;
		    color: #fff;
		    border: none;
		    padding: 5px 10px;
		    border-radius: 5px;
		    cursor: pointer;
		    transition: background 0.3s;
		    font-size: 0.8em;
		}
		
		.comment button:hover {
		    background-color: #c0392b;
		}
		
		/* æ·±è‰²æ¨¡å¼ä¸‹çš„åˆ é™¤æŒ‰é’®æ ·å¼ */
		[data-theme="dark"] .comment button {
		    background-color: #e74c3c;
		    color: #fff;
		}
		
		[data-theme="dark"] .comment button:hover {
		    background-color: #c0392b;
		}


        .theme-toggle:hover {
            background-color: var(--button-hover-bg);
            transform: rotate(90deg);
        }

        /* è¡¨å•æ ·å¼ */
        form {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
            max-width: 500px;
            margin: auto;
        }

        form input, form textarea, form select, form button {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        form input:focus, form textarea:focus, form select:focus {
            border-color: #2980b9;
            outline: none;
        }

        form button {
            background-color: var(--button-bg);
            color: #fff;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        form button:hover {
            background-color: var(--button-hover-bg);
        }

        /* åšå®¢åˆ—è¡¨ */
        .posts-container {
            flex: 1;
        }

        .post {
            background: var(--card-bg);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .post:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .post h3 {
            margin-bottom: 10px;
            color: var(--button-bg);
        }

        .post p.meta {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        .post p.content {
            color: var(--text-color);
            line-height: 1.6;
        }

        /* About å’Œ Contact éƒ¨åˆ† */
        .about, .contact {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
            margin-bottom: 20px;
        }

        .about h2, .contact h2 {
            margin-bottom: 15px;
            color: var(--button-bg);
        }

        .about p, .contact p {
            color: var(--text-color);
            line-height: 1.6;
        }

        /* æœç´¢æ  */
        .search-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-bar input {
            width: 60%;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 8px 0 0 8px;
            outline: none;
            min-width: 200px;
        }

        .search-bar button {
            padding: 10px 20px;
            border: none;
            background-color: var(--button-bg);
            color: #fff;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-bar button:hover {
            background-color: var(--button-hover-bg);
        }

        /* æ¸…é™¤æœç´¢æŒ‰é’® */
        .clear-search-btn {
            background-color: #e74c3c;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .clear-search-btn:hover {
            background-color: #c0392b;
        }
		
		/* ç¾åŒ–ç‚¹èµå’Œç‚¹è¸©æŒ‰é’® */
		.like-btn, .dislike-btn {
		    background: none;
		    border: none;
		    font-size: 0.9em;
		    cursor: pointer;
		    margin-right: 10px;
		    color: var(--text-color); /* æ ¹æ®ä¸»é¢˜è®¾ç½®é¢œè‰² */
		    transition: color 0.3s;
		}
		
		.like-btn:hover, .dislike-btn:hover {
		    color: var(--button-bg); /* é¼ æ ‡æ‚¬æµ®æ—¶æ”¹å˜é¢œè‰² */
		}
		
		.like-btn:disabled, .dislike-btn:disabled {
		    color: #ccc; /* ç¦ç”¨çŠ¶æ€ */
		    cursor: not-allowed;
		}
		
		/* è¯„è®ºåŒºæ ·å¼ */
		.comments-section {
		    margin-top: 20px;
		    background: var(--card-bg);
		    padding: 15px;
		    border-radius: 10px;
		    box-shadow: var(--shadow);
		    backdrop-filter: blur(5px);
		    max-height: 300px;
		    overflow-y: auto;
		}
		
		.comment {
		    padding: 10px;
		    background: rgba(255, 255, 255, 0.9);
		    margin-bottom: 10px;
		    border-radius: 10px;
		    box-shadow: var(--shadow);
		}
		
		/* è¯„è®ºè¾“å…¥åŒºæ ·å¼ */
		.comment-input-area {
		    display: flex;
		    align-items: center;
		    background: var(--card-bg);
		    padding: 15px;
		    border-radius: 10px;
		    box-shadow: var(--shadow);
		    backdrop-filter: blur(5px);
		    margin-top: 20px;
		}
		
		#comment-input {
		    flex: 1;
		    padding: 10px;
		    border: none;
		    border-radius: 10px;
		    margin-right: 10px;
		    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
		    outline: none;
		    resize: none;
		}
		
		#comment-submit {
		    background-color: var(--button-bg);
		    color: #fff;
		    border: none;
		    padding: 10px 20px;
		    border-radius: 10px;
		    cursor: pointer;
		    transition: background 0.3s;
		}
		
		#comment-submit:hover {
		    background-color: var(--button-hover-bg);
		}


        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
            }

            .search-bar input {
                width: 100%;
                border-radius: 8px;
            }

            .search-bar button {
                width: 100%;
                border-radius: 8px;
            }

            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                margin-bottom: 20px;
            }

            .posts-container {
                width: 100%;
            }
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: 10% auto; /* 10% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            border-radius: 10px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(5px);
            position: relative;
        }

        /* å…³é—­æŒ‰é’® */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }

        /* åšå®¢è¯¦æƒ… */
        .blog-details img {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .blog-details .content {
            white-space: pre-wrap;
        }
		/* ç¾åŒ–åˆ é™¤æŒ‰é’® */
		.delete-btn {
		    background-color: #e74c3c;
		    color: white;
		    border: none;
		    padding: 5px 10px;  /* ç¼©å°æŒ‰é’®çš„å°ºå¯¸ */
		    border-radius: 5px;  /* åœ†è§’ */
		    cursor: pointer;
		    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
		    transition: background-color 0.3s ease, box-shadow 0.3s ease;
		    position: absolute;  /* ä½¿æŒ‰é’®èƒ½å¤Ÿå®šä½åˆ°å³è¾¹ */
		    right: 10px;  /* è·ç¦»å³è¾¹çš„è·ç¦» */
		    top: 10px;  /* è·ç¦»é¡¶éƒ¨çš„è·ç¦» */
		    font-size: 0.8em;  /* ç¼©å°å­—ä½“ */
		}
		
		.delete-btn:hover {
		    background-color: #c0392b;
		    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
		}



    </style>
</head>
<body>

    <header>
        <h1>Waffle çš„ä¸ªäººåšå®¢</h1>
        <p>Force Devlog and other funny things</p>
    </header>

    <nav>
        <a href="#" id="nav-home">é¦–é¡µ</a>
        <a href="#" id="nav-about">å…³äºæˆ‘</a>
        <a href="#" id="nav-contact">è”ç³»æˆ‘</a>
        <a href="#" id="nav-login">ç™»å½•</a>
        <a href="#" id="nav-register">æ³¨å†Œ</a>
        <a href="#" id="nav-post" class="hidden">å‘å¸ƒåšå®¢</a>
    </nav>

    <div class="container">
		<div class="sidebar" id="category-sidebar">
		    <h3>åˆ†ç±»</h3>
		    <ul>
		        <li><button data-category="å…¨éƒ¨">å…¨éƒ¨</button></li>
		        <li><button data-category="æŠ€æœ¯">æŠ€æœ¯</button></li>
		        <li><button data-category="ç”Ÿæ´»">ç”Ÿæ´»</button></li>
		        <li><button data-category="å­¦ä¹ ">å­¦ä¹ </button></li>
		        <li><button data-category="å…¶ä»–">å…¶ä»–</button></li>
		    </ul>
		</div>

        <div class="posts-container">

            <!-- æ¬¢è¿ä¿¡æ¯ -->
            <div class="welcome hidden" id="welcome-section">
                <span id="welcome-message">æ¬¢è¿, waffle_hfb!</span>
                <button class="logout-btn" id="logout-btn">é€€å‡º</button>
            </div>

			<!-- æœç´¢æ  -->
			<div class="search-bar" id="search-bar">
			    <input type="text" id="search-input" placeholder="æœç´¢åšå®¢...">
			    <button id="search-btn">æœç´¢</button>
			    <button id="clear-search-btn" class="hidden clear-search-btn">æ¸…é™¤æœç´¢</button>
			</div>

            <!-- é¦–é¡µ - æ˜¾ç¤ºåšå®¢åˆ—è¡¨ -->
            <div id="home-section">
                <h2>æœ€æ–°åšå®¢</h2>
                <div id="posts"></div>
            </div>

            <!-- å…³äºæˆ‘ -->
            <div id="about-section" class="hidden about">
                <h2>å…³äºæˆ‘</h2>
                <p>ä½ å¥½ï¼Œæˆ‘æ˜¯ Waffleï¼Œä¸€ä¸ªçƒ­çˆ±ç¼–ç¨‹å’Œåˆ†äº«çŸ¥è¯†çš„å¼€å‘è€…ã€‚è¿™ä¸ªåšå®¢æ˜¯æˆ‘è®°å½•å­¦ä¹ ä¸å·¥ä½œçš„åœ°æ–¹ï¼Œå¸Œæœ›èƒ½ä¸å¤§å®¶å…±åŒè¿›æ­¥ã€‚</p>
            </div>

            <!-- è”ç³»æˆ‘ -->
            <div id="contact-section" class="hidden contact">
                <h2>è”ç³»æˆ‘</h2>
                <form id="contact-form">
                    <input type="text" id="contact-name" placeholder="æ‚¨çš„åå­—" required>
                    <input type="email" id="contact-email" placeholder="æ‚¨çš„é‚®ç®±" required>
                    <textarea id="contact-message" rows="5" placeholder="æ‚¨çš„ç•™è¨€" required></textarea>
                    <button type="submit">å‘é€</button>
                </form>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div id="login-section" class="hidden">
                <h2>ç™»å½•</h2>
                <form id="login-form">
                    <input type="text" id="login-username" placeholder="ç”¨æˆ·å" required>
                    <input type="password" id="login-password" placeholder="å¯†ç " required>
                    <button type="submit">ç™»å½•</button>
                </form>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div id="register-section" class="hidden">
                <h2>æ³¨å†Œ</h2>
                <form id="register-form">
                    <input type="text" id="register-username" placeholder="ç”¨æˆ·å" required>
                    <input type="password" id="register-password" placeholder="å¯†ç " required>
                    <button type="submit">æ³¨å†Œ</button>
                </form>
            </div>

            <!-- å‘å¸ƒåšå®¢ -->
            <div id="post-section" class="hidden">
                <h2>å‘å¸ƒåšå®¢</h2>
                <form id="post-form">
                    <input type="text" id="post-title" placeholder="åšå®¢æ ‡é¢˜" required>
                    <textarea id="post-content" rows="5" placeholder="åšå®¢å†…å®¹" required></textarea>
                    <input type="file" id="post-image" accept="image/*">
                    <select id="post-category" required>
                        <option value="" disabled selected>é€‰æ‹©åˆ†ç±»</option>
                        <option value="æŠ€æœ¯">æŠ€æœ¯</option>
                        <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
                        <option value="å­¦ä¹ ">å­¦ä¹ </option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                    <button type="submit">å‘å¸ƒ</button>
                </form>
            </div>

        </div>

    </div>

    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" id="theme-toggle">ğŸŒ™</button>
	
    <!-- æ¨¡æ€æ¡†ï¼ˆåšå®¢è¯¦æƒ…ï¼‰ -->
    <div id="blog-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="blog-details">
                <h2 id="modal-title"></h2>
                <p class="meta" id="modal-meta"></p>
                <img id="modal-image" src="" alt="åšå®¢å›¾ç‰‡" style="display: none;">
                <p class="content" id="modal-content"></p>
            </div>
    
            <!-- è¯„è®ºå±•ç¤ºåŒº -->
            <div id="comments-section" class="comments-section">
                <h3>è¯„è®º</h3>
                <div id="comments-list"></div>  <!-- è¯„è®ºåˆ—è¡¨ -->
            </div>
    
            <!-- è¯„è®ºè¾“å…¥åŒº -->
            <div class="comment-input-area">
                <textarea id="comment-input" placeholder="æ·»åŠ è¯„è®º..." rows="3"></textarea>
                <button id="comment-submit">å‘é€</button>
            </div>
        </div>
    </div>


    <!-- EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function(){
            emailjs.init('Waffle'); // æ›¿æ¢ä¸ºä½ çš„ EmailJS User ID
        })();
    </script>

    <script>
        // SHA-256 å“ˆå¸Œå‡½æ•°
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // è·å–å…ƒç´ 
        const navHome = document.getElementById('nav-home');
        const navAbout = document.getElementById('nav-about');
        const navContact = document.getElementById('nav-contact');
        const navLogin = document.getElementById('nav-login');
        const navRegister = document.getElementById('nav-register');
        const navPost = document.getElementById('nav-post');

        const homeSection = document.getElementById('home-section');
        const aboutSection = document.getElementById('about-section');
        const contactSection = document.getElementById('contact-section');
        const loginSection = document.getElementById('login-section');
        const registerSection = document.getElementById('register-section');
        const postSection = document.getElementById('post-section');
        const welcomeSection = document.getElementById('welcome-section');
        const welcomeMessage = document.getElementById('welcome-message');

        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const postForm = document.getElementById('post-form');
        const contactForm = document.getElementById('contact-form');
        const logoutBtn = document.getElementById('logout-btn');

        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const clearSearchBtn = document.getElementById('clear-search-btn');

        const themeToggle = document.getElementById('theme-toggle');

        const categoryButtons = document.querySelectorAll('.sidebar button');

        const blogModal = document.getElementById('blog-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMeta = document.getElementById('modal-meta');
        const modalImage = document.getElementById('modal-image');
        const modalContent = document.getElementById('modal-content');
        const closeModal = document.querySelector('.close');

        let currentUser = localStorage.getItem('currentUser');
        let currentCategory = 'å…¨éƒ¨';
        let currentSearch = '';

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showSection('home');
            loadPosts();
            if (currentUser) {
                showWelcome();
            }
            loadTheme();
        });

        // å¯¼èˆªæ ç‚¹å‡»äº‹ä»¶
        navHome.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('home');
        });

        navAbout.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('about');
        });

        navContact.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('contact');
        });

        navLogin.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('login');
        });

        navRegister.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('register');
        });

        navPost.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('post');
        });

        // åˆ†ç±»æ ç‚¹å‡»äº‹ä»¶
        categoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentCategory = button.getAttribute('data-category');
                filterPosts();
            });
        });

		// æ˜¾ç¤ºæŒ‡å®šçš„éƒ¨åˆ†
		function showSection(section) {
		    // éšè—æ‰€æœ‰éƒ¨åˆ†
		    homeSection.classList.add('hidden');
		    aboutSection.classList.add('hidden');
		    contactSection.classList.add('hidden');
		    loginSection.classList.add('hidden');
		    registerSection.classList.add('hidden');
		    postSection.classList.add('hidden');
		
		    // è·å–æœç´¢æ å’Œåˆ†ç±»æ 
		    const searchBar = document.getElementById('search-bar');  // æœç´¢æ 
		    const categorySidebar = document.getElementById('category-sidebar');  // åˆ†ç±»æ 
		
		    // ç¡®ä¿è¿™ä¸¤éƒ¨åˆ†éƒ½å­˜åœ¨
		    if (searchBar) searchBar.classList.add('hidden');  // é»˜è®¤éšè—æœç´¢æ 
		    if (categorySidebar) categorySidebar.classList.add('hidden');  // é»˜è®¤éšè—åˆ†ç±»æ 
		
		    // æ ¹æ®å‚æ•°æ˜¾ç¤ºéƒ¨åˆ†
		    if (section === 'home') {
		        homeSection.classList.remove('hidden');
		        if (searchBar) searchBar.classList.remove('hidden');  // ä»…åœ¨é¦–é¡µæ˜¾ç¤ºæœç´¢æ 
		        if (categorySidebar) categorySidebar.classList.remove('hidden');  // ä»…åœ¨é¦–é¡µæ˜¾ç¤ºåˆ†ç±»æ 
		    } else if (section === 'about') {
		        aboutSection.classList.remove('hidden');
		    } else if (section === 'contact') {
		        contactSection.classList.remove('hidden');
		    } else if (section === 'login') {
		        loginSection.classList.remove('hidden');
		    } else if (section === 'register') {
		        registerSection.classList.remove('hidden');
		    } else if (section === 'post') {
		        postSection.classList.remove('hidden');
		    }
		}



		function showWelcome() {
		    if (!currentUser) {
		        welcomeMessage.textContent = 'è¯·ç™»å½•';  
		        navLogin.classList.remove('hidden');
		        navRegister.classList.remove('hidden');
		        navPost.classList.add('hidden');  
		        return;
		    }
		
		    welcomeSection.classList.remove('hidden');
		    welcomeMessage.textContent = `æ¬¢è¿, ${currentUser}!`;
		    navLogin.classList.add('hidden');
		    navRegister.classList.add('hidden');
		    navPost.classList.remove('hidden');
		}

        // æ³¨å†Œè¡¨å•æäº¤
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value.trim();

            if (username === '' || password === '') {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            let users = JSON.parse(localStorage.getItem('users')) || {};

            if (users[username]) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨');
                return;
            }

            const hashedPassword = await sha256(password);
            users[username] = hashedPassword;
            localStorage.setItem('users', JSON.stringify(users));
            alert('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
            registerForm.reset();
            showSection('login');
        });

        // ç™»å½•è¡¨å•æäº¤
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();

            let users = JSON.parse(localStorage.getItem('users')) || {};

            if (users[username]) {
                const hashedPassword = await sha256(password);
                if (users[username] === hashedPassword) {
                    localStorage.setItem('currentUser', username);
                    currentUser = username;
                    showWelcome();
                    showSection('home');
                    return;
                }
            }
            alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
        });

        // å‘å¸ƒåšå®¢è¡¨å•æäº¤
        postForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = sanitizeHTML(document.getElementById('post-title').value.trim());
            const content = sanitizeHTML(document.getElementById('post-content').value.trim());
            const category = document.getElementById('post-category').value;
            const imageInput = document.getElementById('post-image');

            if (title === '' || content === '' || !category) {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            // å¤„ç†å›¾ç‰‡
            if (imageInput.files && imageInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageData = event.target.result;
                    savePost(title, content, category, imageData);
                };
                reader.readAsDataURL(imageInput.files[0]);
            } else {
                savePost(title, content, category, null);
            }
        });

        function savePost(title, content, category, imageData) {
            let posts = JSON.parse(localStorage.getItem('posts')) || [];
            const newPost = {
                id: Date.now(), // å”¯ä¸€ID
                author: currentUser,
                title: title,
                content: content,
                category: category,
                date: new Date().toLocaleString(),
                image: imageData,
				likes: 0,  // åˆå§‹åŒ–ç‚¹èµ
				dislikes: 0,  // åˆå§‹åŒ–ç‚¹è¸©
				comments: []  // åˆå§‹åŒ–è¯„è®ºä¸ºç©ºæ•°ç»„
            };

            posts.unshift(newPost); // æœ€æ–°çš„å¸–å­åœ¨æœ€å‰é¢
            localStorage.setItem('posts', JSON.stringify(posts));
            alert('åšå®¢å‘å¸ƒæˆåŠŸ');
            postForm.reset();
            loadPosts();
            showSection('home');
        }


        // è”ç³»è¡¨å•æäº¤
        contactForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = sanitizeHTML(document.getElementById('contact-name').value.trim());
            const email = sanitizeHTML(document.getElementById('contact-email').value.trim());
            const message = sanitizeHTML(document.getElementById('contact-message').value.trim());

            if (name === '' || email === '' || message === '') {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            // ä½¿ç”¨ EmailJS å‘é€é‚®ä»¶
            const serviceID = 'service_03xd39m'; // æ›¿æ¢ä¸ºä½ çš„ EmailJS æœåŠ¡ ID
            const templateID = 'template_iuerxyz'; // æ›¿æ¢ä¸ºä½ çš„ EmailJS æ¨¡æ¿ ID

            const templateParams = {
                from_name: name,
                from_email: email,
                message: message
            };

            emailjs.send(serviceID, templateID, templateParams)
                .then(() => {
                    alert(`æ„Ÿè°¢æ‚¨çš„è”ç³»ï¼Œ${name}ï¼æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ã€‚`);
                    contactForm.reset();
                    showSection('home');
                }, (error) => {
                    console.error('å‘é€å¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯:', error);
                    alert('å‘é€å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚æˆ–è€…å‘é€è‡³ huafubing0306@gmail.com é‚®ç®±');
                });
        });

        // åŠ è½½å¹¶æ˜¾ç¤ºåšå®¢
        function loadPosts(filteredPosts = null) {
            const postsDiv = document.getElementById('posts');
            postsDiv.innerHTML = '';

            let posts = JSON.parse(localStorage.getItem('posts')) || [];

            if (filteredPosts) {
                posts = filteredPosts;
            }

            if (posts.length === 0) {
                postsDiv.innerHTML = '<p>æš‚æ— åšå®¢ã€‚</p>';
                return;
            }

            posts.forEach(post => {
                const postDiv = document.createElement('div');
                postDiv.classList.add('post');
                postDiv.setAttribute('data-id', post.id);

                const postTitle = document.createElement('h3');
                postTitle.textContent = post.title;

                const postMeta = document.createElement('p');
                postMeta.classList.add('meta');
                postMeta.innerHTML = `<strong>ä½œè€…:</strong> ${post.author} &nbsp; | &nbsp; <strong>åˆ†ç±»:</strong> ${post.category} &nbsp; | &nbsp; <strong>æ—¶é—´:</strong> ${post.date}`;

                const postContent = document.createElement('p');
                postContent.classList.add('content');
                postContent.textContent = post.content.length > 100 ? post.content.substring(0, 100) + '...' : post.content;

                postDiv.appendChild(postTitle);
                postDiv.appendChild(postMeta);
                postDiv.appendChild(postContent);
				
		        // å¦‚æœå½“å‰ç”¨æˆ·æ˜¯ä½œè€…æˆ–ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºåˆ é™¤æŒ‰é’®
		        if (post.author === currentUser) {
		            const deleteBtn = document.createElement('button');
		            deleteBtn.textContent = 'åˆ é™¤åšå®¢';
		            deleteBtn.classList.add('delete-btn');  // ä½¿ç”¨ç¾åŒ–åçš„æ ·å¼
		
		            // ç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶ç›´æ¥åˆ é™¤ DOM å…ƒç´ ï¼Œå¹¶æ›´æ–° localStorage
		            deleteBtn.addEventListener('click', (event) => {
		                event.stopPropagation();  // é˜²æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è¯¯è§¦å…¶ä»–å…ƒç´ 
		                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡åšå®¢å—ï¼Ÿ')) {
		                    postDiv.remove();  // ä»é¡µé¢ä¸­ç§»é™¤è¯¥åšå®¢å…ƒç´ 
		                    deletePost(index);  // ä» localStorage ä¸­åˆ é™¤è¯¥åšå®¢
							loadPosts();
		                }
		            });
		
		            postDiv.appendChild(deleteBtn);
		        }
				
				const likeBtn = document.createElement('span');
				likeBtn.innerHTML = `ğŸ‘ ${post.likes || 0}`;
				likeBtn.classList.add('like-btn');
				likeBtn.addEventListener('click', () => {
					event.stopPropagation();  
				    if (!currentUser) {
				        alert('è¯·å…ˆç™»å½•ï¼');
				        showSection('login');
				        return;
				    }
				    
				    // é˜²æ­¢é‡å¤ç‚¹èµ
				    let likedPosts = JSON.parse(localStorage.getItem(currentUser + '_likedPosts')) || [];
				    if (likedPosts.includes(post.id)) {
				        alert('æ‚¨å·²ç»ç‚¹èµè¿‡è¿™ç¯‡æ–‡ç« ');
				        return;
				    }
				
				    post.likes = (post.likes || 0) + 1;
				    likedPosts.push(post.id);
				    localStorage.setItem(currentUser + '_likedPosts', JSON.stringify(likedPosts));
				    localStorage.setItem('posts', JSON.stringify(posts));
				    loadPosts(); // åˆ·æ–°åšå®¢åˆ—è¡¨ï¼Œæ›´æ–°ç‚¹èµæ•°
				});
				
				const dislikeBtn = document.createElement('span');
				dislikeBtn.innerHTML = `ğŸ‘ ${post.dislikes || 0}`;
				dislikeBtn.classList.add('dislike-btn');
				dislikeBtn.addEventListener('click', () => {
					event.stopPropagation();
				    if (!currentUser) {
				        alert('è¯·å…ˆç™»å½•ï¼');
				        showSection('login');
				        return;
				    }
				    
				    // é˜²æ­¢é‡å¤ç‚¹è¸©
				    let dislikedPosts = JSON.parse(localStorage.getItem(currentUser + '_dislikedPosts')) || [];
				    if (dislikedPosts.includes(post.id)) {
				        alert('æ‚¨å·²ç»ç‚¹è¸©è¿‡è¿™ç¯‡æ–‡ç« ');
				        return;
				    }
				
				    post.dislikes = (post.dislikes || 0) + 1;
				    dislikedPosts.push(post.id);
				    localStorage.setItem(currentUser + '_dislikedPosts', JSON.stringify(dislikedPosts));
				    localStorage.setItem('posts', JSON.stringify(posts));
				    loadPosts(); // åˆ·æ–°åšå®¢åˆ—è¡¨ï¼Œæ›´æ–°ç‚¹è¸©æ•°
				});
				
				postDiv.appendChild(likeBtn);
				postDiv.appendChild(dislikeBtn);

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ‰“å¼€æ¨¡æ€æ¡†
                postDiv.addEventListener('click', () => {
                    openModal(post.id);
                });

                postsDiv.appendChild(postDiv);
            });
        }
		
		function deletePost(index) {
		    // ä» localStorage ä¸­è·å–åšå®¢æ•°æ®
		    let posts = JSON.parse(localStorage.getItem('posts')) || [];
		
		    // åˆ é™¤æŒ‡å®šçš„åšå®¢
		    posts.splice(index, 1);
		
		    // æ›´æ–° localStorage
		    localStorage.setItem('posts', JSON.stringify(posts));
		
		    // ç¡®è®¤åˆ é™¤
		    alert('åšå®¢å·²æˆåŠŸåˆ é™¤');
		}



        // æ‰“å¼€æ¨¡æ€æ¡†æ˜¾ç¤ºåšå®¢è¯¦æƒ…
		function openModal(postId) {
			    const posts = JSON.parse(localStorage.getItem('posts')) || [];
			    const post = posts.find(p => p.id === postId);
			    if (!post) return;
			
			    modalTitle.textContent = post.title;
			    modalMeta.innerHTML = `<strong>ä½œè€…:</strong> ${post.author} &nbsp; | &nbsp; <strong>åˆ†ç±»:</strong> ${post.category} &nbsp; | &nbsp; <strong>æ—¶é—´:</strong> ${post.date}`;
			    modalContent.textContent = post.content;
			
			    if (post.image) {
			        modalImage.src = post.image;
			        modalImage.style.display = 'block';
			    } else {
			        modalImage.style.display = 'none';
			    }
			
			    const commentsList = document.getElementById('comments-list');
			    commentsList.innerHTML = '';
			
			    if (post.comments && post.comments.length > 0) {
			        post.comments.forEach((comment, index) => {
			            const commentDiv = document.createElement('div');
			            commentDiv.classList.add('comment');
			            commentDiv.innerHTML = `<strong>${comment.user}:</strong> ${comment.text}`;
			
			            // å¦‚æœå½“å‰ç”¨æˆ·æ˜¯è¯„è®ºçš„ä½œè€…ï¼Œæ˜¾ç¤ºåˆ é™¤æŒ‰é’®
			            if (comment.user === currentUser) {
			                const deleteBtn = document.createElement('button');
			                deleteBtn.textContent = 'åˆ é™¤';
			                deleteBtn.style.marginLeft = '10px';
			
			                // ç‚¹å‡»æŒ‰é’®ååˆ é™¤è¯¥è¯„è®ºçš„ HTML å…ƒç´ 
			                deleteBtn.addEventListener('click', () => {
			                    deleteComment(postId, index, commentDiv);
			                });
			
			                commentDiv.appendChild(deleteBtn);
			            }
			
			            commentsList.appendChild(commentDiv);
			        });
			    } else {
			        commentsList.innerHTML = '<p>æš‚æ— è¯„è®º</p>';
			    }
			
			    blogModal.style.display = 'block';
				
		    // è§£ç»‘ä¹‹å‰çš„ç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢é‡å¤ç»‘å®š
		    const commentSubmit = document.getElementById('comment-submit');
		    commentSubmit.replaceWith(commentSubmit.cloneNode(true)); // è§£é™¤äº‹ä»¶ç»‘å®šï¼Œé¿å…é‡å¤
		    const newCommentSubmit = document.getElementById('comment-submit');
		
		    // ç»‘å®šæ–°çš„æäº¤è¯„è®ºäº‹ä»¶
		    newCommentSubmit.addEventListener('click', () => {
		        const commentInput = document.getElementById('comment-input');
		        const comment = commentInput.value.trim();
		        
		        if (comment === '') {
		            alert('è¯„è®ºä¸èƒ½ä¸ºç©º');
		            return;
		        }
		
		        // æ·»åŠ è¯„è®ºåˆ°å½“å‰åšå®¢
		        const posts = JSON.parse(localStorage.getItem('posts')) || [];
		        const post = posts.find(p => p.id === postId);
		
		        if (!post.comments) {
		            post.comments = [];
		        }
		
		        post.comments.push({ user: currentUser, text: comment });
		        localStorage.setItem('posts', JSON.stringify(posts));
		
		        // æ¸…ç©ºè¾“å…¥æ¡†å¹¶åˆ·æ–°è¯„è®º
		        commentInput.value = '';
		        openModal(postId); // é‡æ–°åŠ è½½è¯„è®ºåˆ—è¡¨
		    });
		}

		function deleteComment(postId, commentIndex, commentDiv) {
		    const posts = JSON.parse(localStorage.getItem('posts')) || [];
		    const post = posts.find(p => p.id === postId);
		
		    if (post && post.comments) {
		        post.comments.splice(commentIndex, 1);  // åˆ é™¤è¯„è®ºæ•°æ®
		        localStorage.setItem('posts', JSON.stringify(posts));  // æ›´æ–° localStorage
		
		        // ä» DOM ä¸­åˆ é™¤è¯¥è¯„è®ºå…ƒç´ 
		        commentDiv.remove();
		    }
		}




        // å…³é—­æ¨¡æ€æ¡†
        closeModal.addEventListener('click', () => {
            blogModal.style.display = 'none';
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', (e) => {
            if (e.target == blogModal) {
                blogModal.style.display = 'none';
            }
        });

        // æœç´¢åŠŸèƒ½
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim().toLowerCase();
            if (query === '') {
                alert('è¯·è¾“å…¥æœç´¢å†…å®¹');
                return;
            }

            let posts = JSON.parse(localStorage.getItem('posts')) || [];
            const filteredPosts = posts.filter(post => 
                post.title.toLowerCase().includes(query) || 
                post.content.toLowerCase().includes(query) ||
                post.category.toLowerCase().includes(query)
            );

            if (filteredPosts.length === 0) {
                alert('æœªæ‰¾åˆ°åŒ¹é…çš„åšå®¢');
                return;
            }

            currentSearch = query;
            loadPosts(filteredPosts);
            clearSearchBtn.classList.remove('hidden');
        });
		
        // æ¸…é™¤æœç´¢
        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            loadPosts();
            clearSearchBtn.classList.add('hidden');
        });

        // è¾“å…¥æ¡†å›è½¦æœç´¢
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchBtn.click();
            }
        });

        // åˆ†ç±»è¿‡æ»¤
        function filterPosts() {
            let posts = JSON.parse(localStorage.getItem('posts')) || [];
            if (currentCategory !== 'å…¨éƒ¨') {
                posts = posts.filter(post => post.category === currentCategory);
            }
            if (currentSearch !== '') {
                posts = posts.filter(post => 
                    post.title.toLowerCase().includes(currentSearch) || 
                    post.content.toLowerCase().includes(currentSearch) ||
                    post.category.toLowerCase().includes(currentSearch)
                );
            }
            loadPosts(posts);
        }

        // ç›‘å¬æœç´¢è¾“å…¥å˜åŒ–ä»¥æ›´æ–°å½“å‰æœç´¢
        searchInput.addEventListener('input', () => {
            currentSearch = searchInput.value.trim().toLowerCase();
            filterPosts();
        });

        // é€€å‡ºç™»å½•
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            currentUser = null;
            welcomeSection.classList.add('hidden');
            navLogin.classList.remove('hidden');
            navRegister.classList.remove('hidden');
            navPost.classList.add('hidden');
            showSection('home');
        });

        // è¾“å…¥æ¶ˆæ¯’å‡½æ•°ï¼Œé˜²æ­¢XSS
        function sanitizeHTML(str) {
            var temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const targetTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', targetTheme);
            localStorage.setItem('theme', targetTheme);
            updateThemeToggleIcon(targetTheme);
        });
		

        // åŠ è½½ä¸»é¢˜
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggleIcon(savedTheme);
        }

        // æ›´æ–°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®å›¾æ ‡
        function updateThemeToggleIcon(theme) {
            if (theme === 'dark') {
                themeToggle.textContent = 'â˜€ï¸';
            } else {
                themeToggle.textContent = 'ğŸŒ™';
            }
        }
    </script>

</body>
</html>